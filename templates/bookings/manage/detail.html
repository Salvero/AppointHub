{% extends 'base.html' %}

{% block title %}Booking #{{ booking.pk }} - {{ shop.name }} - AppointHub{% endblock %}

{% block content %}
<div class="max-w-2xl">
    <div class="mb-6">
        <a href="{% url 'bookings:manage_list' shop.slug %}" class="text-indigo-600 hover:text-indigo-800">&larr; Back to Bookings</a>
    </div>

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">Booking #{{ booking.pk }}</h1>
        <span class="inline-block px-3 py-1 text-sm font-medium rounded
            {% if booking.status == 'confirmed' %}bg-green-100 text-green-700
            {% elif booking.status == 'pending' %}bg-yellow-100 text-yellow-700
            {% elif booking.status == 'completed' %}bg-gray-100 text-gray-700
            {% elif booking.status == 'cancelled' %}bg-red-100 text-red-700
            {% elif booking.status == 'no_show' %}bg-orange-100 text-orange-700
            {% endif %}">
            {{ booking.get_status_display }}
        </span>
    </div>

    <!-- Booking details -->
    <div class="bg-white shadow-sm rounded-lg p-6 mb-6">
        <h3 class="font-medium text-gray-800 mb-4">Appointment Details</h3>

        <div class="space-y-3">
            <div class="flex justify-between">
                <span class="text-gray-500">Customer</span>
                <span class="font-medium text-gray-800">{{ booking.customer_display_name }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-500">Email</span>
                <span class="text-gray-800">{{ booking.customer_email }}</span>
            </div>
            {% if booking.customer_phone %}
            <div class="flex justify-between">
                <span class="text-gray-500">Phone</span>
                <span class="text-gray-800">{{ booking.customer_phone }}</span>
            </div>
            {% endif %}
            <hr>
            <div class="flex justify-between">
                <span class="text-gray-500">Service</span>
                <span class="font-medium text-gray-800">{{ booking.service.name }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-500">Staff</span>
                <span class="text-gray-800">{{ booking.staff.display_name }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-500">Date</span>
                <span class="text-gray-800">{{ booking.date|date:'l, F j, Y' }}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-gray-500">Time</span>
                <span class="text-gray-800">{{ booking.start_time|time:'g:i A' }} - {{ booking.end_time|time:'g:i A' }}</span>
            </div>
            <hr>
            <div class="flex justify-between">
                <span class="text-gray-500">Price</span>
                <span class="font-semibold text-gray-800">${{ booking.price }}</span>
            </div>
            {% if booking.notes %}
            <hr>
            <div>
                <span class="text-gray-500 block mb-1">Notes</span>
                <p class="text-gray-800">{{ booking.notes }}</p>
            </div>
            {% endif %}
            {% if booking.cancellation_reason %}
            <hr>
            <div>
                <span class="text-gray-500 block mb-1">Cancellation Reason</span>
                <p class="text-gray-800">{{ booking.cancellation_reason }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Status actions -->
    {% if booking.is_upcoming %}
    <div class="bg-white shadow-sm rounded-lg p-6 mb-6">
        <h3 class="font-medium text-gray-800 mb-4">Update Status</h3>

        <div class="flex flex-wrap gap-2">
            {% if booking.status == 'pending' %}
            <form method="post" action="{% url 'bookings:manage_status' shop.slug booking.pk %}" class="inline">
                {% csrf_token %}
                <input type="hidden" name="status" value="confirmed">
                <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                    Confirm
                </button>
            </form>
            {% endif %}

            {% if booking.status in 'pending,confirmed' %}
            <form method="post" action="{% url 'bookings:manage_status' shop.slug booking.pk %}" class="inline">
                {% csrf_token %}
                <input type="hidden" name="status" value="completed">
                <button type="submit" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">
                    Mark Completed
                </button>
            </form>
            <form method="post" action="{% url 'bookings:manage_status' shop.slug booking.pk %}" class="inline">
                {% csrf_token %}
                <input type="hidden" name="status" value="no_show">
                <button type="submit" class="px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700">
                    Mark No Show
                </button>
            </form>
            {% endif %}

            {% if booking.can_cancel %}
            <a href="{% url 'bookings:manage_cancel' shop.slug booking.pk %}"
               class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                Cancel Booking
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Metadata -->
    <div class="text-sm text-gray-500">
        <p>Created: {{ booking.created_at|date:'M j, Y g:i A' }}</p>
        <p>Last updated: {{ booking.updated_at|date:'M j, Y g:i A' }}</p>
    </div>
</div>
{% endblock %}
